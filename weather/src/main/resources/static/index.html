<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>天气服务系统</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- 自定义样式 -->
    <link href="css/style.css" rel="stylesheet" />
    <style>
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      .main-content-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .content-iframe {
        flex: 1;
        width: 100%;
        border: none;
        display: block;
      }
      .footer {
        margin-top: auto;
      }
    </style>
  </head>
  <body>
    <!-- 导航栏 -->
    <div id="navbarContainer"></div>

    <!-- 主内容区 - 使用iframe -->
    <div class="main-content-wrapper">
      <iframe
        id="contentFrame"
        class="content-iframe"
        src="pages/index.html"
      ></iframe>
    </div>

    <!-- 页脚 -->
    <footer class="footer">
      <div class="container text-center">
        <p class="mb-0">&copy; 2025 天气服务系统. 保留所有权利.</p>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- API 封装 -->
    <script src="js/api.js"></script>
    <!-- 工具函数 -->
    <script src="js/utils.js"></script>
    <!-- 导航栏组件 -->
    <script src="js/components/navbar.js"></script>

    <script>
      let navbar;
      let currentPage = "index";

      // 导航到指定页面
      function navigateToPage(pageUrl) {
        const iframe = document.getElementById("contentFrame");
        if (iframe) {
          iframe.src = "pages/" + pageUrl;

          // 更新导航栏活动状态
          const pageMap = {
            "index.html": "index",
            "weather.html": "weather",
            "warnings.html": "warnings",
            "traffic.html": "traffic",
            "attractions.html": "attractions",
            "help.html": "help",
            "about.html": "about",
          };

          const pageId = pageMap[pageUrl] || "index";
          if (navbar) {
            navbar.setActive(pageId);
          }
          currentPage = pageId;
        }
      }

      // 初始化
      (() => {
        // 初始化导航栏
        navbar = new Navbar("navbarContainer", "index");

        // 从URL参数获取初始页面
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get("page") || "index";
        const pageMap = {
          index: "index.html",
          weather: "weather.html",
          warnings: "warnings.html",
          traffic: "traffic.html",
          attractions: "attractions.html",
          help: "help.html",
          about: "about.html",
        };

        if (pageMap[page]) {
          navigateToPage(pageMap[page]);
        } else if (page.endsWith(".html")) {
          navigateToPage(page);
        }
      })();
    </script>
  </body>
</html>
